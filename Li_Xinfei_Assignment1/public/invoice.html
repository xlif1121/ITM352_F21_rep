<!--Borrowed and modified from WODs, Labs, Assignment1 workshop, modified template from ww3schools.com-->
<script src="./products.js" type="text/javascript"></script>

<script>
    let params = (new URL(document.location)).searchParams;
    var quantities = [];
    // form was submitted so process the invoice
    if (params.has('purchase_submit')) {
        for (i = 0; i < products.length; i++) {
            if (params.has(`quantity${i}`)) {
                a_qty = params.get(`quantity${i}`);
                quantities[i] = a_qty;
            }
        }
    } else {
        document.write('no form submitted');
        
    }
    console.log(quantities);
</script>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="Products-style.css" type="text/css"rel="stylesheet">
    <title>Document</title>
   
</head>

<body>
    <table border="2">
        <tbody>
            <tr>
                <th style="text-align: center;" width="43%">Item</th>
                <th style="text-align: center;" width="11%">Quantity</th>
                <th style="text-align: center;" width="13%">Price</th>
                <th style="text-align: center;" width="54%">Extended price</th>
            </tr>
            <script>
                subtotal = 0;
                for (i = 0; i < products.length; i++) {
                    if (quantities[i] > 0 && quantities[i]<=100 && parseInt(quantities[i]) ==quantities[i]) {  //check if the quantites is vad or not
                        // product row
                        extended_price = quantities[i] * products[i].price
                        subtotal += extended_price;
                        document.write(`
      <tr>
        <td width="43%">${products[i].name}</td>
        <td align="center" width="11%">${quantities[i]}</td>
        <td width="13%">\$${products[i].price}</td>
        <td width="54%">\$${extended_price}</td>
      </tr>
      `);
                        
                    }else {
                            document.write(`<font color="red">Make sure you double check your quantities!</font>`);
                        }
                }
                
                //compute tax
            
                var tax_rate = 0.05;
                var tax = tax_rate * subtotal;

                //compute shipping
                if (subtotal <= 49.99) {
                    shipping = 15;
                }
                else if (subtotal <= 100) {
                    shipping = 25;
                }
                else {
                    shipping = 0.05 * subtotal; // 5% of subtotal
                }
                //compute grant total
                var total = subtotal + tax + shipping;
                //from invoice WODs
            </script>
            <tr>
                <td colspan="4" width="100%">&nbsp;</td>
            </tr>
            <tr>
                <td style="text-align: center;font-family: Garamond;" colspan="3" width="67%">Sub-total</td>
                <td width="54%">$
                    <script>document.write(subtotal);</script>
                </td>
            </tr>
            <tr>
                <td style="text-align: center;font-family: Garamond;" colspan="3" width="67%"><span
                        style="font-family: Lucida Bright;">Tax @
                        <script>document.write(100 * tax_rate);</script>%
                    </span></td>
                <td width="54%">$
                    <script>document.write(tax.toFixed(2));</script>
                </td>
            </tr>
            <td style="text-align: center; font-family: Garamond;" colspan="3" width="67%">Shipping</span></td>
            <td width="54%">$
                <script>document.write(shipping.toFixed(2));</script>
            </td>
            </tr>
            <tr>
                <td style="text-align: center;font-family: Garamond;" colspan="3" width="67%"><strong>Total</strong>
                </td>
                <td width="54%"><strong>$
                        <script>document.write(total.toFixed(2));</script>
                    </strong></td>
            </tr>
        </tbody>
    </table>
    <h5>&#x1F4CB;SHIPPING POLICY:<br>&#x1F33A; We will collect 5%  for tax<br>&#x1F4B2;A subtotal $0 - $49.99 will be $15 shipping<br>&#x1F4B0;A
        subtotal $50.00-$100.00 will be $25 shipping<br>&#x1F4EB;Subtotals over $100.00 will be charged 5% of the
        subtotal amount<br>&#x1F69A;Estimate transit time: 3-6 business days</h5>
    <input type="button" class="button" value="Back to Home" onclick="window.location.href = 'products_display.html';">
</body>

</html>